@ligne1 = ['La Défense', 'Esplanade de La Défense', 'Pont de Neuilly', 'Les Sablons', 'Porte Maillot', 'Argentine', 'Charles de Gaulle – Étoile', 'George V', 'Franklin D. Roosevelt', 'Champs-Élysées – Clemenceau', 'Concorde', 'Tuileries', 'Palais Royal – Musée du Louvre', 'Louvre – Rivoli', 'Châtelet', 'Hôtel de Ville', 'Saint-Paul', 'Bastille', 'Gare de Lyon', 'Reuilly – Diderot', 'Nation', 'Porte de Vincennes', 'Saint-Mandé', 'Bérault', 'Château de Vincennes']
@ligne2 = ['Porte Dauphine', 'Victor Hugo', 'Charles de Gaulle - Étoile', 'Ternes', 'Courcelles', 'Monceau', 'Villiers', 'Rome', 'Place de Clichy', 'Blanche', 'Pigalle', 'Anvers', 'Barbès – Rochechouart', 'La Chapelle', 'Stalingrad', 'Jaurès', 'Colonel Fabien', 'Belleville', 'Couronnes', 'Ménilmontant', 'Père Lachaise', 'Philippe Auguste', 'Alexandre Dumas', 'Avron', 'Nation']
@ligne3 = ['Pont de Levallois — Bécon', 'Anatole France', 'Louise Michel', 'Porte de Champerret', 'Pereire', 'Wagram', 'Malesherbes', 'Villiers', 'Europe', 'Saint-Lazare', 'Havre — Caumartin', 'Opéra', 'Quatre-Septembre', 'Bourse', 'Sentier', 'Réaumur — Sébastopol', 'Arts et Métiers', 'Temple', 'République', 'Parmentier', 'Rue Saint-Maur', 'Père Lachaise', 'Gambetta', 'Porte de Bagnolet', 'Gallieni']
@ligne3bis = ['Porte des Lilas', 'Saint-Fargeau', 'Pelleport', 'Gambetta']
@ligne4 = ['Porte de Clignancourt', 'Simplon', 'Marcadet – Poissonniers', 'Château Rouge', 'Barbès – Rochechouart', 'Gare du Nord', 'Gare de l\'Est', 'Château d\'Eau', 'Strasbourg – Saint-Denis', 'Réaumur – Sébastopol', 'Étienne Marcel', 'Les Halles', 'Châtelet', 'Cité', 'Saint-Michel', 'Odéon', 'Saint-Germain-des-Prés', 'Saint-Sulpice', 'Saint-Placide', 'Montparnasse – Bienvenüe', 'Vavin', 'Raspail', 'Denfert-Rochereau', 'Mouton-Duvernet', 'Alésia', 'Porte d\'Orléans', 'Mairie de Montrouge']
@ligne5 = ['Bobigny – Pablo Picasso', 'Bobigny – Pantin – Raymond Queneau', 'Église de Pantin', 'Hoche', 'Porte de Pantin', 'Ourcq', 'Laumière', 'Jaurès', 'Stalingrad', 'Gare du Nord', 'Gare de l\'Est', 'Jacques Bonsergent', 'République', 'Oberkampf', 'Richard-Lenoir', 'Bréguet – Sabin', 'Bastille', 'Quai de la Rapée', 'Gare d\'Austerlitz', 'Saint-Marcel', 'Campo Formio', 'Place d\'Italie']
@ligne6 = ['Charles de Gaulle — Étoile', 'Kléber', 'Boissière', 'Trocadéro', 'Passy', 'Bir-Hakeim', 'Dupleix', 'La Motte-Picquet — Grenelle', 'Cambronne', 'Sèvres — Lecourbe', 'Pasteur', 'Montparnasse — Bienvenüe', 'Edgar Quinet', 'Raspail', 'Denfert-Rochereau', 'Saint-Jacques', 'Glacière', 'Corvisart', 'Place d\'Italie', 'Nationale', 'Chevaleret', 'Quai de la Gare', 'Bercy', 'Dugommier', 'Daumesnil', 'Bel-Air', 'Picpus', 'Nation']
@ligne7_Mairie = ['La Courneuve', 'Fort d\'Aubervilliers', 'Aubervilliers - Pantin - Quatre Chemins', 'Porte de la Villette', 'Corentin Cariou', 'Crimée', 'Riquet', 'Stalingrad', 'Louis Blanc', 'Château-Landon', 'Gare de l\'Est', 'Poissonnière', 'Cadet', 'Le Peletier', 'Chaussée d\'Antin - La Fayette', 'Opéra', 'Pyramides', 'Palais Royal - Musée du Louvre', 'Pont Neuf', 'Châtelet ', 'Pont Marie', 'Sully - Morland', 'Jussieu', 'Place Monge', 'Censier - Daubenton', 'Les Gobelins', 'Place d\'Italie', 'Tolbiac', 'Maison Blanche', 'Porte d\'Italie', 'Porte de Choisy', 'Porte d\'Ivry', 'Pierre et Marie Curie', 'Mairie d\'Ivry']
@ligne7_Villejuif = ['La Courneuve', 'Fort d\'Aubervilliers', 'Aubervilliers - Pantin - Quatre Chemins', 'Porte de la Villette', 'Corentin Cariou', 'Crimée', 'Riquet', 'Stalingrad', 'Louis Blanc', 'Château-Landon', 'Gare de l\'Est', 'Poissonnière', 'Cadet', 'Le Peletier', 'Chaussée d\'Antin - La Fayette', 'Opéra', 'Pyramides', 'Palais Royal - Musée du Louvre', 'Pont Neuf', 'Châtelet ', 'Pont Marie', 'Sully - Morland', 'Jussieu', 'Place Monge', 'Censier - Daubenton', 'Les Gobelins', 'Place d\'Italie', 'Tolbiac', 'Maison Blanche', 'Le Kremlin-Bicêtre', 'Villejuif - Léo Lagrange', 'Villejuif - Paul Vaillant-Couturier', 'Villejuif - Louis Aragon']
@ligne7bis = ['Louis Blanc', 'Jaurès', 'Bolivar', 'Buttes Chaumont', 'Botzaris', 'Danube', 'Pré Saint-Gervais']
@ligne7bis_ = ['Louis Blanc', 'Jaurès', 'Bolivar', 'Buttes Chaumont', 'Botzaris', 'Place des Fêtes', 'Pré Saint-Gervais']
@ligne8 = ['Balard', 'Lourmel', 'Boucicaut', 'Félix Faure', 'Commerce', 'La Motte-Picquet – Grenelle', 'École Militaire', 'La Tour-Maubourg', 'Invalides', 'Concorde', 'Madeleine', 'Opéra', 'Richelieu – Drouot', 'Grands Boulevards', 'Bonne Nouvelle', 'Strasbourg – Saint-Denis', 'République', 'Filles du Calvaire', 'Saint-Sébastien – Froissart', 'Chemin Vert', 'Bastille', 'Ledru-Rollin', 'Faidherbe – Chaligny', 'Reuilly – Diderot', 'Montgallet', 'Daumesnil', 'Michel Bizot', 'Porte Dorée', 'Porte de Charenton', 'Liberté', 'Charenton – Écoles', 'École Vétérinaire de Maisons-Alfort', 'Maisons-Alfort – Stade', 'Maisons-Alfort – Les Juilliottes', 'Créteil – L\'Échat', 'Créteil – Université', 'Créteil – Préfecture', 'Créteil – Pointe du Lac']
@ligne9 = ['Pont de Sèvres', 'Billancourt', 'Marcel Sembat', 'Porte de Saint-Cloud', 'Exelmans', 'Michel-Ange - Molitor', 'Michel-Ange - Auteuil', 'Jasmin', 'Ranelagh', 'La Muette', 'Rue de la Pompe', 'Trocadéro', 'Iéna', 'Alma - Marceau', 'Franklin D. Roosevelt', 'Saint-Philippe du Roule', 'Miromesnil', 'Saint-Augustin', 'Havre - Caumartin', 'Chaussée d\'Antin - La Fayette', 'Richelieu - Drouot', 'Grands Boulevards', 'Bonne Nouvelle', 'Strasbourg - Saint-Denis', 'République', 'Oberkampf', 'Saint-Ambroise', 'Voltaire', 'Charonne', 'Rue des Boulets', 'Nation', 'Buzenval', 'Maraîchers', 'Porte de Montreuil', 'Robespierre', 'Croix de Chavaux', 'Mairie de Montreuil']
@ligne10 = ['Boulogne – Pont de Saint-Cloud', 'Boulogne – Jean Jaurès', 'Porte d\'Auteuil', 'Michel-Ange – Auteuil', 'Église d\'Auteuil', 'Mirabeau', 'Javel – André Citroën', 'Charles Michels', 'Avenue Émile Zola', 'La Motte-Picquet – Grenelle', 'Ségur', 'Duroc', 'Vaneau', 'Sèvres – Babylone', 'Mabillon', 'Odéon', 'Cluny – La Sorbonne', 'Maubert – Mutualité', 'Cardinal Lemoine', 'Jussieu', 'Gare d\'Austerlitz']
@ligne10_ = ['Boulogne – Pont de Saint-Cloud', 'Boulogne – Jean Jaurès', 'Michel-Ange – Molitor', 'Chardon Lagache', 'Mirabeau', 'Javel – André Citroën', 'Charles Michels', 'Avenue Émile Zola', 'La Motte-Picquet – Grenelle', 'Ségur', 'Duroc', 'Vaneau', 'Sèvres – Babylone', 'Mabillon', 'Odéon', 'Cluny – La Sorbonne', 'Maubert – Mutualité', 'Cardinal Lemoine', 'Jussieu', 'Gare d\'Austerlitz']
@ligne11 = ['Mairie des Lilas', 'Porte des Lilas', 'Télégraphe', 'Place des Fêtes', 'Jourdain', 'Pyrénées', 'Belleville', 'Goncourt', 'République', 'Arts et Métiers', 'Rambuteau', 'Hôtel de Ville', 'Châtelet']
@ligne12 = ['Front Populaire', 'Porte de la Chapelle', 'Marx Dormoy', 'Marcadet – Poissonniers', 'Jules Joffrin', 'Lamarck – Caulaincourt', 'Abbesses', 'Pigalle', 'Saint-Georges', 'Notre-Dame-de-Lorette', 'Trinité – d\'Estienne d\'Orves', 'Saint-Lazare', 'Madeleine', 'Concorde', 'Assemblée Nationale', 'Solférino', 'Rue du Bac', 'Sèvres – Babylone', 'Rennes', 'Notre-Dame-des-Champs', 'Montparnasse – Bienvenüe', 'Falguière', 'Pasteur', 'Volontaires', 'Vaugirard', 'Convention', 'Vaugirard Shops', 'Porte de Versailles', 'Corentin Celton', 'Mairie d\'Issy']
@ligne13 = ['Saint-Denis - Université', 'Basilique de Saint-Denis', 'Saint-Denis - Porte de Paris', 'Carrefour Pleyel', 'Mairie de Saint-Ouen', 'Garibaldi', 'Porte de Saint-Ouen', 'Guy Môquet', 'La Fourche', 'Place de Clichy', 'Liège', 'Saint-Lazare', 'Miromesnil', 'Champs-Élysées – Clemenceau', 'Invalides', 'Varenne', 'Saint-François-Xavier', 'Duroc', 'Montparnasse - Bienvenüe', 'Gaîté', 'Pernety', 'Plaisance', 'Porte de Vanves', 'Malakoff - Plateau de Vanves', 'Malakoff - Rue Étienne Dolet', 'Châtillon - Montrouge']
@ligne13_ = ['Asnières – Gennevilliers – Les Courtilles', 'Les Agnettes', 'Gabriel Péri', 'Mairie de Clichy', 'Porte de Clichy', 'Brochant', 'La Fourche', 'Place de Clichy', 'Liège', 'Saint-Lazare', 'Miromesnil', 'Champs-Élysées – Clemenceau', 'Invalides', 'Varenne', 'Saint-François-Xavier', 'Duroc', 'Montparnasse - Bienvenüe', 'Gaîté', 'Pernety', 'Plaisance', 'Porte de Vanves', 'Malakoff - Plateau de Vanves', 'Malakoff - Rue Étienne Dolet', 'Châtillon - Montrouge']
@ligne14 = ['Saint-Lazare', 'Madeleine', 'Pyramides', 'Châtelet', 'Gare de Lyon', 'Bercy', 'Cour Saint-Émilion', 'Bibliothèque François Mitterrand', 'Olympiades']

@lines = [@ligne1, @ligne2, @ligne3, @ligne3bis, @ligne4, @ligne5, @ligne6, @ligne7_Mairie, @ligne7_Villejuif, @ligne7bis, @ligne7bis_, @ligne8, @ligne9, @ligne10, @ligne10_, @ligne11, @ligne12, @ligne13, @ligne13_, @ligne14]

@lines_s = ['ligne 1', 'ligne 2', 'ligne 3', 'ligne 3 bis', 'ligne 4', 'ligne 5', 'ligne 6', 'ligne 7', 'ligne 7', 'ligne 7 bis', 'ligne 7 bis', 'ligne 8', 'ligne 9', 'ligne 10', 'ligne 10', 'ligne 11', 'ligne 12', 'ligne 13', 'ligne 13', 'ligne 14']

@db = {}

require 'rainbow'

def set_up
  for i in 0..@lines.length - 1
    for j in 0..@lines[i].length
      @db[@lines[i][j]] = {:name=>@lines[i][j], :adjacentStations=>[], :lines=>[], :distance=>Float::INFINITY, :parent=>nil} if !@db[@lines[i][j]]
      @db[@lines[i][j]][:lines].push(@lines_s[i])
      if j > 0
        @db[@lines[i][j]][:adjacentStations].push(@lines[i][j-1]) if !@db[@lines[i][j]][:adjacentStations].include? @lines[i][j-1]
      end
      if j < @lines[i].length - 1
        @db[@lines[i][j]][:adjacentStations].push(@lines[i][j+1]) if !@db[@lines[i][j]][:adjacentStations].include? @lines[i][j+1]
      end
    end
  end
end

def plan_trip(src, dst)
  queue = [@db[src]]
  explored = {}
  current = nil
  res = {:stations=>[], :src=>src, :dst=>dst}
  @db[src][:distance] = 0;
  while queue.length > 0
    queue.sort_by! { |h| h[:distance] }
    current = queue.shift
    if current[:name] == dst
      res[:distance] = current[:distance]
      while current != @db[src]
        res[:stations].push(current[:name])
        current = current[:parent]
      end
      return res
    end
    explored[current[:name]] = true
    for i in 0..current[:adjacentStations].length-1
      if ((!explored.key? current[:adjacentStations][i]) &&
        (!queue.include? current[:adjacentStations][i])) || @db[current[:adjacentStations][i]][:distance] > current[:distance]+1
        queue.push(@db[current[:adjacentStations][i]])
        @db[current[:adjacentStations][i]][:distance] = current[:distance] + 1
        @db[current[:adjacentStations][i]][:parent] = current
      end
    end
  end
end

def msg(res)
  stations = res[:stations].reverse
  stations.unshift(res[:src])
  stationLines = {res[:src]=> @db[res[:src]][:lines]}
  for i in 0..res[:stations].length-1
    stationLines[res[:stations][i]] = @db[res[:stations][i]][:lines]
  end
  lineChanges = []
  currentLine = stationLines[res[:src]][0]
  tmpLine = [currentLine]
  for i in 0..stations.length-1
    if i != stations.length-1 && (stationLines[stations[i+1]].include? currentLine)
      tmpLine.push(stations[i+1])
    else
      lineChanges.push(tmpLine)
      if stations[i+1] != nil
        for j in 0..stationLines[stations[i+1]].length-1
          currentLine = stationLines[stations[i+1]][j] if stationLines[stations[i]].include? stationLines[stations[i+1]][j]
        end
        tmpLine = [currentLine, stations[i]]
        tmpLine.push(stations[i+1])
      end
    end
  end
  output = Rainbow("Your must travel through the following stops on #{ lineChanges[0][0]} : ").green
  for i in 1..lineChanges[0].length-1
    if i == lineChanges[0].length-1
      output += "#{lineChanges[0][i]}.\n"
      transfer = lineChanges[0][i]
    else
      output += "#{lineChanges[0][i]}, "
    end
  end
  for i in 1..lineChanges.length-1
    # ASCII Train from: etrinida@phakt.usc.edu (Elson R. Trinidad) with slight modifications
    output += "
                 ___|___
               _|__(*)__|_
            / |[  Paris  ]| \\
            | |     |     | |
            | |     |     | |
            | |_____|_____| |
            |\\|====(#{Rainbow('M').blue})====|/|
            |\\[][]_____[][]/|
            |/  |  [ ]  |  \\|
             #{Rainbow("==").yellow}((       ))#{Rainbow("==").yellow}
           #{Rainbow("===//=========\\\\===").yellow}
          #{Rainbow("===//===========\\\\===").yellow}

              Metro #{lineChanges[i][0]}\n
"
    output += Rainbow("Change at #{transfer} for #{lineChanges[i][0]}.").red + "\nYour journey continues through the following stops: "
    for j in 2..lineChanges[i].length-1
      if j == lineChanges[i].length-1
        output += "#{lineChanges[i][j]}.\n"
        transfer = lineChanges[i][j]
      else
        output += "#{lineChanges[i][j]}, "
      end
    end
  end
  output += Rainbow("#{stations.length-1} stops in total.\n\n").blue
  print output
end

set_up
print Rainbow("\n\n
                                .,*(#%&&@@@@@@@&&%#(*,
                           ./#&@@@@@@@@@@@@@@@@@@@@@@@@@&(*.
                      ./%@@@@@@@@@@@@&%#(//*//(#%%@@@@@@@@@@@@#/
                    /%@@@@@@@@&%/..                  .*%&@@@@@@@@#*
                 .%@@@@@@@@#,.                            ,#@@@@@@@
               ,(@@@@@@.                                   .#&@@@@@@/.
              (@@@@@@&*                                         *&@@@@@@/.
            %@@@@@%/                                               /%@@@@@#
          /%@@@@@(                                                   (@@@@@%*
         /@@@@@%*        .,//*.                         .*//,.        *%@@@@@*
        %@@@@@%        ,#@@@@@@%                       %@@@@@@#,        %@@@@@#
       (@@@@@%         #@@@@@@@@#                     #@@@@@@@@#         *@@@@@/
      /@@@@@*          #@@@@@@@@@#,                 ,#@@@@@@@@@#          *@@@@@*
     /&@@@@#           #@@@@@@@@@@%                 %@@@@@@@@@@#           #@@@@&/
     &@@@@(.           #@@@@@@@@@@@#.             .(@@@@@@@@@@@#           .(@@@@&
    *@@@@@.            #@@@@@@@@@@@@%             %@@@@@@@@@@@@#            .@@@@@*
    #@@@@%             #@@@@@@#%@@@@@(          .(@@@@@%(@@@@@@#             %@@@@#
    &@@@&*             #@@@@@@, &@@@@@(.       .&@@@@@& ,@@@@@@#             *%@@@&
    @@@@%,             #@@@@@@, ,@@@@@@%       #@@@@@@, ,@@@@@@#             ,%@@@@
    @@@@#,             #@@@@@@,  /&@@@@@/.    /@@@@@&/  ,@@@@@@#             ,#@@@@
    @@@@#,             #@@@@@@,   ,@@@@@@#   #@@@@@@,   ,@@@@@@#             ,#@@@@
    @@@@%,             #@@@@@@,    /&@@@@@/ *@@@@@&/    ,@@@@@@#             ,%@@@@
    &@@@&*             #@@@@@@,     .&@@@@@@@@@@@&.     ,@@@@@@#             *&@@@&
    %@@@@%             #@@@@@@,      ,@@@@@@@@@@#,      ,@@@@@@#             %@@@@%
    *@@@@&.            #@@@@@@,       /&@@@@@@@&.       ,@@@@@@#            .@@@@@*
    .&@@@@/.           #@@@@@@,        ,@@@@@@@,        ,@@@@@@#           .(@@@@&.
     (&@@@&(           #@@@@@@,         /&@@@&/         ,@@@@@@#           (@@@@@(
      *@@@@@/.         #@@@@@@,                         ,@@@@@@#          /@@@@@*
       #@@@@@#         #@@@@@@,                         ,@@@@@@#         ,@@@@@#
        %@@@@@#        /&@@@@&.                         .&@@@@&/        #@@@@@&.
        ./@@@@@#,        */*.                             .*/*        ,#@@@@@(.
          (&@@@@@/                                                   /@@@@@@(
            (&@@@@@%.                                             .%@@@@@@(
              #@@@@@@&,                                         ,&@@@@@@#*
               ,#@@@@@@&(.                                   .(&@@@@@@#*
                 ,%@@@@@@@@#,                             .(@@@@@@@@&,
                    /%@@@@@@@@&%*..                  .*%&@@@@@@@@%(
                       .*%@@@@@@@@@@@@@@&&&&&&&@@@@@@@@@@@@@@&/,
                           ./#&@@@@@@@@@@@@@@@@@@@@@@@@@@#(.
\n\n").blue

puts "Welcome to the Paris Metro!"
print "Start : "
start = gets.chomp
while !@db.key? start
  print "Station not found, please enter again: "
  start = gets.chomp
end
print "Destination : "
nd = gets.chomp
while !@db.key? nd
  print "Station not found, please enter again: "
  nd = gets.chomp
end
puts
msg(plan_trip(start, nd))

#'Palais Royal – Musée du Louvre', 'Anvers'
